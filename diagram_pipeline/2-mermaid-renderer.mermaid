graph TB
    subgraph Input
        A[Mermaid Code] --> B[Parser]
        B --> C[AST Generator]
    end

    subgraph Enhancement
        C --> D[Layout Optimizer]
        D --> E[Style Engine]
        
        subgraph "Layout Optimization"
            D --> D1[Node Spacing Analysis]
            D --> D2[Edge Routing]
            D --> D3[Hierarchical Balancing]
            
            D1 & D2 & D3 --> D4[Optimized Layout]
        end
        
        subgraph "Style Processing"
            E --> E1[Color Scheme Generator]
            E --> E2[Typography Handler]
            E --> E3[Shape/Line Styler]
            
            LLM[LLM Style Advisor] --> |Style Suggestions| E1
            LLM --> |Font Pairing| E2
            LLM --> |Visual Hierarchy| E3
            
            E1 & E2 & E3 --> E4[Unified Style]
        end
    end

    subgraph Output
        D4 --> F[SVG Generator]
        E4 --> F
        F --> G[Final SVG]
        
        G --> H1[Academic Format]
        G --> H2[Web Optimized]
        G --> H3[High-res Export]
    end

    style LLM fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#9f9,stroke:#333,stroke-width:2px
